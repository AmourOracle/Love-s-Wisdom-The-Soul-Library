/* ================= 基本樣式與變數 ================= */
:root {
    --primary-color: #f64740; /* 主要顏色，用於按鈕、進度條等 */
    --secondary-color: #333333; /* 次要顏色，用於深色文字 */
    --background-color: #f5f5f5; /* 結果頁面背景色 */
    --text-color: #ffffff; /* 主要文字顏色 (亮色背景) */
    --text-color-dark: #333333; /* 深色文字顏色 (用於亮色背景) */
    --shadow-color: rgba(0, 0, 0, 0.2); /* 陰影顏色 */
    --card-padding: 24px; /* 卡片內邊距 */
    --border-radius: 12px; /* 邊框圓角 */
    --transition-duration: 0.6s; /* 畫面轉換動畫時間 */
    --transition-timing: cubic-bezier(0.25, 0.1, 0.25, 1.0); /* 畫面轉換動畫曲線 */
    --deep-blue-bg: #121824; /* 主要深藍色背景 */
    --intro-fadein-delay: 0.1s; /* Intro 頁面元素淡入延遲 */
    --intro-fadein-duration: 1s; /* Intro 頁面元素淡入時間 */

    /* --- SVG Animation Timings --- */
    --svg-base-draw-duration: 2.5s; /* SVG 基礎繪製時間 */
    --svg-stagger-delay: 0.15s; /* SVG 路徑繪製交錯延遲 */
    --svg-max-stagger-steps: 4; /* SVG 最大交錯步數 */
    /* SVG 入口縮放動畫總時間 */
    --svg-entrance-zoom-duration: calc(var(--svg-base-draw-duration) + var(--svg-stagger-delay) * var(--svg-max-stagger-steps));
    --svg-glow-delay: calc(var(--svg-entrance-zoom-duration) * 0.9); /* SVG 光暈延遲 */
    --svg-glow-duration: 2.5s; /* SVG 光暈動畫時間 */
    --svg-fade-in-duration: 1.5s; /* SVG 字幕淡入時間 */
    --svg-fade-in-delay: 0.6s; /* SVG 字幕淡入延遲 */

    /* Path 退場動畫相關變數 */
    --preloader-path-exit-duration: 0.8s; /* Preloader 路徑退場時間 */
    --preloader-path-exit-blur: 5px; /* Preloader 路徑退場模糊度 */
    --preloader-path-exit-scale-up: 1.2; /* Preloader 路徑放大退場比例 */
    --preloader-path-exit-scale-down: 0.8; /* Preloader 路徑縮小退場比例 */
    --preloader-bg-exit-duration: calc(var(--preloader-path-exit-duration) * 1.1); /* Preloader 背景退場時間 */

    /* 爆炸時間 */
    --explosion-duration: 1.0s; /* 統一的爆炸動畫時間 */

    /* 統一的 Hover 背景色 */
    --button-hover-bg: rgba(255, 255, 255, 0.2); /* 用於按鈕和選項的 hover 效果 */
}

/* 基本重置和盒模型設置 */
* {
    box-sizing: border-box; /* 盒模型設為 border-box */
    margin: 0; /* 清除預設外邊距 */
    padding: 0; /* 清除預設內邊距 */
}

/* 全局頁面樣式 */
body {
    font-family: 'Noto Serif TC', serif, 'Times New Roman', Times, serif; /* 字體設置 */
    line-height: 1.6; /* 行高 */
    background-color: var(--deep-blue-bg); /* 背景色 */
    color: var(--text-color); /* 預設文字顏色 */
    height: 100vh; /* 視口高度 */
    width: 100vw; /* 視口寬度 */
    overflow: hidden; /* 隱藏滾動條 */
    margin: 0;
    padding: 0;
    display: flex; /* 使用 Flexbox 佈局 */
    justify-content: center; /* 水平居中 */
    align-items: center; /* 垂直居中 */
    perspective: 800px; /* 設置 3D 透視效果 */
}

/* 主要容器樣式 */
.container {
    width: 100%;
    max-width: calc(100vh * 9 / 16); /* 最大寬度，保持 9:16 比例 (基於高度) */
    height: 100vh; /* 高度佔滿視口 */
    max-height: calc(100vw * 16 / 9); /* 最大高度，保持 16:9 比例 (基於寬度) */
    position: relative; /* 相對定位，用於內部絕對定位元素 */
    overflow: hidden; /* 隱藏超出內容 */
    background-color: var(--deep-blue-bg); /* 背景色 */
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.3); /* 陰影效果 */
    margin: auto; /* 自動外邊距實現居中 */
}


/* ================= 動畫關鍵幀 ================= */
/* 基本淡入效果 */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
/* 基本淡出效果 */
@keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-10px); }
}
/* 旋轉動畫 (未使用，但保留) */
@keyframes spin {
    to { transform: rotate(360deg); }
}
/* 粒子爆炸動畫 */
@keyframes explodeForwardBlur {
    0% { opacity: 1; filter: blur(0px); transform: translate3d(0, 0, 5px) rotate(0deg) scale(1); }
    60% { opacity: 0.9; filter: blur(1px); }
    90% { opacity: 0.4; filter: blur(4px); }
    100% { opacity: 0; filter: blur(8px); transform: translate3d(var(--tx, 0), var(--ty, 0), var(--tz, 0)) rotate(var(--rz, 0deg)) scale(var(--sc, 1)); }
}
/* Intro 頁面元素淡入動畫 */
@keyframes introElementFadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- SVG Animation Keyframes --- */
/* SVG 路徑繪製和填充動畫 */
@keyframes drawStrokeAndFill {
    0% { stroke-dashoffset: 1500; fill: none; fill-opacity: 0; opacity: 1; } /* 開始時只有描邊，偏移量大 */
    70% { stroke-dashoffset: 0; fill: var(--svg-fill-color, #ffffff); fill-opacity: 0; opacity: 1; } /* 描邊完成，準備填充 */
    100% { stroke-dashoffset: 0; fill: var(--svg-fill-color, #ffffff); fill-opacity: 1; opacity: 1; } /* 填充完成 */
}
/* SVG 組淡入 (未使用，但保留) */
@keyframes fadeInGroup {
    from { opacity: 0; }
    to { opacity: 1; }
}
/* SVG 光暈閃爍效果 */
@keyframes glow {
    from { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.6)) drop-shadow(0 0 10px rgba(246, 71, 64, 0.4)); }
    to { filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.8)) drop-shadow(0 0 15px rgba(246, 71, 64, 0.6)); }
}
/* SVG 光暈淡入效果 */
@keyframes fadeInGlow {
     from { filter: drop-shadow(0 0 0px rgba(255, 255, 255, 0)) drop-shadow(0 0 0px rgba(246, 71, 64, 0)); opacity: 0; }
     to { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.6)) drop-shadow(0 0 10px rgba(246, 71, 64, 0.4)); opacity: 1;}
}
/* Preloader SVG 入口縮放動畫 */
@keyframes preloaderEntranceZoom {
    from { transform: scale(1); }
    to { transform: scale(1.05); }
}
/* Preloader SVG 路徑放大退場動畫 */
@keyframes preloaderPathExitScaleUp {
    from { opacity: 1; transform: scale(1.05); filter: blur(0px); } /* 從入口動畫的最終狀態開始 */
    to { opacity: 0; transform: scale(var(--preloader-path-exit-scale-up)); filter: blur(var(--preloader-path-exit-blur)); visibility: hidden; }
}
/* Preloader SVG 路徑縮小退場動畫 */
@keyframes preloaderPathExitScaleDown {
    from { opacity: 1; transform: scale(1.05); filter: blur(0px); } /* 從入口動畫的最終狀態開始 */
    to { opacity: 0; transform: scale(var(--preloader-path-exit-scale-down)); filter: blur(var(--preloader-path-exit-blur)); visibility: hidden; }
}


/* ================= 預加載畫面 ================= */
.preloader {
    z-index: 9999; /* 最高層級 */
    position: fixed; /* 固定定位，覆蓋全屏 */
    top: 0; left: 0; width: 100vw; height: 100vh;
    background-color: var(--deep-blue-bg); /* 背景色 */
    display: flex; /* Flexbox 佈局 */
    justify-content: center; /* 水平居中 */
    align-items: center; /* 垂直居中 */
    opacity: 0; /* 初始透明 */
    visibility: hidden; /* 初始隱藏 */
    pointer-events: none; /* 不阻擋滑鼠事件 */
}
.preloader.active {
    opacity: 1; /* 激活時不透明 */
    visibility: visible; /* 激活時可見 */
    pointer-events: auto; /* 激活時可交互 */
    transition: none; /* 激活時無過渡效果 */
    background-color: var(--deep-blue-bg);
}
/* Preloader 背景退場 class */
.preloader.is-exiting-bg {
    opacity: 0; /* 退場時變透明 */
    transition: opacity var(--preloader-bg-exit-duration) ease-out; /* 背景淡出過渡 */
    pointer-events: none; /* 退場時不阻擋事件 */
}
/* Preloader 內容退場 */
.preloader.is-exiting-bg .preloader-content {
    opacity: 0; /* 內容也變透明 */
    transition: opacity calc(var(--preloader-bg-exit-duration) * 0.8) ease-out; /* 內容淡出稍快 */
}
/* Preloader 內容容器 */
.preloader-content {
    text-align: center; /* 文字居中 */
    color: var(--text-color); /* 文字顏色 */
    width: 90%; /* 寬度 */
    max-width: 450px; /* 最大寬度 */
    position: relative; /* 相對定位 */
}
/* SVG 容器 */
#preloader-svg-container {
    width: 100%; /* 寬度佔滿 */
    margin-bottom: 20px; /* 與下方內容的間距 */
}

/* Preloader SVG 樣式 */
#preloader-svg {
    width: 100%; /* 寬度佔滿容器 */
    height: auto; /* 高度自適應 */
    display: block; /* 塊級元素 */
    overflow: visible; /* 允許內容溢出 (例如陰影) */
    transform: scale(1); /* 初始縮放 */
    opacity: 1; /* 初始不透明 */
    filter: none; /* 初始無濾鏡 */
    /* animation is controlled by JS and classes */
    transform-origin: center center; /* 縮放中心 */
    will-change: filter, transform, opacity; /* 預告瀏覽器這些屬性會變動 */
}
/* Preloader 激活時 SVG 的入口動畫 */
.preloader.active #preloader-svg {
    /* 應用入口縮放動畫，並保持結束狀態 */
    animation: preloaderEntranceZoom var(--svg-entrance-zoom-duration) ease-out forwards;
}
/* SVG 光暈激活時的動畫 */
#preloader-svg.glow-active {
    /* 應用入口縮放、光暈淡入、光暈閃爍動畫 */
    animation: preloaderEntranceZoom var(--svg-entrance-zoom-duration) ease-out forwards,
               fadeInGlow calc(var(--svg-glow-duration) * 0.4) ease-out var(--svg-glow-delay) forwards,
               glow var(--svg-glow-duration) ease-in-out calc(var(--svg-glow-delay) + (var(--svg-glow-duration) * 0.4)) infinite alternate;
}

/* --- SVG Path/Group Animation Setup --- */
/* 主標題路徑樣式和動畫 */
#preloader-svg #main-title-group path {
    stroke-width: 0.5px; /* 描邊寬度 */
    stroke: #ffffff; /* 描邊顏色 */
    stroke-dasharray: 1500; /* 虛線長度，用於繪製效果 */
    stroke-dashoffset: 1500; /* 虛線偏移量，初始不顯示 */
    fill: none; /* 初始無填充 */
    fill-opacity: 0; /* 初始填充透明 */
    opacity: 0; /* 初始透明，由動畫控制 */
    transform: translateZ(0); /* 啟用硬件加速 */
    will-change: stroke-dashoffset, fill, opacity, transform, filter; /* 動畫屬性預告 */
    animation-name: drawStrokeAndFill; /* 應用繪製動畫 */
    animation-duration: var(--svg-base-draw-duration); /* 動畫時間 */
    animation-timing-function: ease-out; /* 動畫曲線 */
    animation-fill-mode: forwards; /* 保持結束狀態 */
    --svg-fill-color: #ffffff; /* 填充顏色變數 */
    transform-origin: center center; /* 變換中心 */
}
/* 主標題不同部分的動畫延遲 */
#preloader-svg #main-title-group .st1 { animation-delay: 0s; }
#preloader-svg #main-title-group .st0 { animation-delay: calc(var(--svg-stagger-delay) * 1); }
#preloader-svg #main-title-group .st2 { animation-delay: calc(var(--svg-stagger-delay) * 2); }
#preloader-svg #main-title-group .st4 { animation-delay: calc(var(--svg-stagger-delay) * 3); }
#preloader-svg #main-title-group .st5 { animation-delay: calc(var(--svg-stagger-delay) * 4); }

/* 字幕組樣式 */
#preloader-svg #eng-subtitle-group,
#preloader-svg #chn-subtitle-group {
    opacity: 1; /* 組本身可見，由內部 path 控制動畫 */
    transform-origin: center center;
    will-change: opacity, transform, filter;
}
/* 字幕路徑樣式和動畫 */
#preloader-svg #eng-subtitle-group path,
#preloader-svg #chn-subtitle-group path {
    stroke-width: 0.5px;
    stroke: #ffffff; /* 描邊顏色 */
    stroke-dasharray: 1500;
    stroke-dashoffset: 1500;
    fill: none; fill-opacity: 0; opacity: 0; /* 初始隱藏 */
    transform: translateZ(0);
    will-change: stroke-dashoffset, fill, opacity, transform, filter;
    animation-name: drawStrokeAndFill; /* 應用繪製動畫 */
    animation-duration: var(--svg-base-draw-duration);
    animation-timing-function: ease-out;
    animation-fill-mode: forwards;
    --svg-fill-color: #ffffff; /* 預設填充色 */
    transform-origin: center center;
    animation-delay: var(--svg-fade-in-delay); /* 使用字幕的淡入延遲 */
}
/* 不同字幕的顏色 */
#preloader-svg #eng-subtitle-group path { --svg-fill-color: #ffffff; stroke: #ffffff;}
#preloader-svg #chn-subtitle-group path { --svg-fill-color: #f2f2f2; stroke: #f2f2f2; }
#preloader-svg #chn-subtitle-group .st3 { --svg-fill-color: #f2f2f2; stroke: #f2f2f2;}

/* Path 退場動畫應用 class */
#preloader-svg path.is-exiting-scale-up {
    transform-origin: center center;
    animation: preloaderPathExitScaleUp var(--preloader-path-exit-duration) ease-out forwards;
    /* animation-delay is set by JS */
    opacity: 1 !important; /* 覆蓋繪製動畫的結束狀態 */
    visibility: visible !important;
    will-change: opacity, transform, filter;
}
#preloader-svg path.is-exiting-scale-down {
    transform-origin: center center;
    animation: preloaderPathExitScaleDown var(--preloader-path-exit-duration) ease-out forwards;
    /* animation-delay is set by JS */
    opacity: 1 !important;
    visibility: visible !important;
    will-change: opacity, transform, filter;
}


/* ================= 通用屏幕容器 ================= */
/* 所有屏幕容器的基礎樣式 */
.screen-container {
    display: block; /* 或 flex，取決於內部佈局需求 */
    position: absolute; /* 絕對定位，疊加在一起 */
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0; /* 初始透明 */
    visibility: hidden; /* 初始隱藏 */
    /* 過渡效果，用於屏幕切換 */
    transition: opacity var(--transition-duration) var(--transition-timing), visibility 0s linear var(--transition-duration);
    overflow: hidden; /* 預設隱藏溢出內容 */
    background-color: var(--deep-blue-bg); /* 預設背景色 */
}
/* 激活狀態的屏幕容器 */
.screen-container.active {
    opacity: 1; /* 不透明 */
    visibility: visible; /* 可見 */
    /* 激活時的過渡效果 */
    transition: opacity var(--transition-duration) var(--transition-timing), visibility 0s linear 0s;
}
/* 測驗頁面特殊樣式 */
#test-container { background-color: transparent; /* 測驗頁面背景透明，依賴背景圖 */ }
/* 結果頁面特殊樣式 */
#result-container {
    background-color: var(--background-color); /* 結果頁面使用亮色背景 */
    overflow-y: auto; /* 允許垂直滾動 */
    color: var(--text-color-dark); /* 結果頁面使用深色文字 */
}
/* 隱藏結果頁面的滾動條 */
#result-container::-webkit-scrollbar { display: none; width: 0; background: transparent; } /* Chrome, Safari */
#result-container { scrollbar-width: none; -ms-overflow-style: none; } /* Firefox, IE/Edge */

/* ================= 首頁卡片式設計 ================= */
/* 首頁背景圖 */
.intro-background {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-size: contain; /* 完整顯示圖片，可能留白 */
    background-position: center center; /* 圖片居中 */
    background-repeat: no-repeat; /* 不重複圖片 */
    z-index: 1; /* 背景層級 */
    opacity: 0; /* 初始透明 */
    background-color: var(--deep-blue-bg); /* 背景色 */
}
/* 首頁遮罩層 */
.intro-overlay {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    /* 漸變遮罩，上下深中間淺 */
    background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 30%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0.7) 100%);
    z-index: 2; /* 遮罩層級 */
    opacity: 0; /* 初始透明 */
}
/* 首頁內容容器 */
.intro-content {
    position: relative; /* 相對定位 */
    z-index: 3; /* 內容層級最高 */
    height: 100%; /* 佔滿父容器高度 */
    display: flex; /* Flexbox 佈局 */
    flex-direction: column; /* 垂直排列 */
    justify-content: space-between; /* 元素兩端對齊 */
    padding: 40px 30px; /* 內邊距 */
}
/* Intro 頁面激活時的元素淡入動畫 */
#intro-container.active .intro-background,
#intro-container.active .intro-overlay {
    animation: introElementFadeIn var(--intro-fadein-duration) ease-out var(--intro-fadein-delay) forwards;
}
#intro-container.active .intro-title-placeholder {
    opacity: 0; /* 初始透明 */
    animation: introElementFadeIn var(--intro-fadein-duration) ease-out calc(var(--intro-fadein-delay) + 0.2s) forwards; /* 稍延遲淡入 */
}
#intro-container.active .card-body,
#intro-container.active .card-footer {
    opacity: 0; /* 初始透明 */
    animation: introElementFadeIn var(--intro-fadein-duration) ease-out calc(var(--intro-fadein-delay) + 0.4s) forwards; /* 更延遲淡入 */
}
/* Intro 頁面標題 SVG 容器 */
.intro-title-placeholder {
    position: absolute; /* 絕對定位 */
    top: 5%; /* 靠近頂部 */
    left: 50%; /* 水平居中 */
    transform: translateX(-50%); /* 精確水平居中 */
    width: 60%; /* 寬度 */
    max-width: 300px; /* 最大寬度 */
    z-index: 4; /* 標題層級 */
    display: flex; justify-content: center; align-items: center;
}
/* Intro 頁面標題 SVG 樣式 */
#intro-title-svg {
    width: 100%; height: auto;
    /* 添加光暈效果 */
    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.6)) drop-shadow(0 0 10px rgba(246, 71, 64, 0.4));
    transition: filter 0.5s ease-in-out; /* 光暈過渡 */
    transform: scale(1.05); /* 保持與 Preloader 結束時一致的縮放 */
    transform-origin: center center;
}
/* Intro 頁面標題 SVG 內部路徑樣式 (確保可見) */
#intro-title-svg g path {
    fill: #ffffff; stroke: none; opacity: 1; animation: none !important;
    stroke-dasharray: none !important; stroke-dashoffset: 0 !important; fill-opacity: 1 !important;
    transform: none !important; filter: none !important;
}
#intro-title-svg #main-title-group path { fill: #ffffff; } /* 主標題顏色 */
#intro-title-svg #eng-subtitle-group path,
#intro-title-svg #chn-subtitle-group path { fill: #cccccc; } /* 副標題顏色 */
#intro-title-svg #chn-subtitle-group .st3 { fill: #b3b3b3; } /* 中文副標題特定顏色 */

/* Intro 頁面中間內容區域 */
.card-body {
    flex: 1; /* 佔據剩餘空間 */
    display: flex; flex-direction: column; justify-content: center; /* 垂直居中 */
}
/* Intro 頁面描述文字 */
.card-body .description {
    font-size: 18px; line-height: 1.6; margin-bottom: 20px; max-width: 90%;
    text-align: center; margin-left: auto; margin-right: auto; /* 水平居中 */
}
/* Intro 頁面底部區域 */
.card-footer {
    margin-bottom: 40px; /* 底部間距 */
    text-align: center; /* 內容居中 */
    position: relative; /* 相對定位，用於按鈕爆炸容器 */
}
/* Intro 頁面元信息 (版權等) */
.card-meta {
    margin-top: 20px; /* 與按鈕間距 */
    font-size: 12px; /* 字號 */
    opacity: 0.7; /* 透明度 */
    text-align: center;
}

/* ================= 按鈕樣式 ================= */
/* 通用按鈕基礎樣式 */
.btn {
    display: inline-block; /* 行內塊元素 */
    padding: 14px 28px; /* 內邊距 */
    border-radius: 50px; /* 圓角 */
    border: none; /* 無邊框 */
    font-size: 16px; /* 字號 */
    font-weight: 600; /* 字重 */
    cursor: pointer; /* 鼠標樣式 */
    transition: all 0.3s ease; /* 過渡效果 */
    font-family: 'Noto Serif TC', serif; /* 字體 */
    text-align: center; /* 文字居中 */
    margin: 0 auto; /* 水平居中 */
    position: relative; /* 相對定位 */
}
/* Intro 頁面開始按鈕特殊樣式 */
.btn-svg-style {
    background-color: transparent; /* 透明背景 */
    border: 1px solid rgba(255, 255, 255, 0.7); /* 邊框 */
    color: rgba(255, 255, 255, 0.9); /* 文字顏色 */
    padding: 12px 30px; /* 內邊距 */
    border-radius: 8px; /* 圓角 */
    /* 過渡效果 */
    transition: background-color 0.4s ease, color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease, transform 0.3s ease;
    box-shadow: 0 0 8px rgba(246, 71, 64, 0); /* 初始無陰影 */
}
/* Intro 開始按鈕 Hover 效果 */
.btn-svg-style:hover {
    background-color: var(--button-hover-bg); /* 使用統一的 hover 背景色 */
    color: #ffffff; /* 文字變白 */
    border-color: rgba(255, 255, 255, 0.9); /* 邊框變亮 */
    transform: translateY(-2px) scale(1.02); /* 輕微上移放大 */
    box-shadow: 0 0 15px rgba(246, 71, 64, 0.6); /* 添加光暈 */
}
/* 按鈕文字容器 */
.btn-svg-style .btn-text {
    display: inline-block;
    transition: opacity 0.3s ease; /* 透明度過渡 */
    opacity: 1; /* 初始不透明 */
}
/* 隱藏按鈕文字時的樣式 */
.btn-svg-style .btn-text.hidden { opacity: 0; }
/* 按鈕被“爆炸”後的樣式 */
.btn.exploded {
    opacity: 0 !important; /* 強制透明 */
    transform: scale(0.9) !important; /* 強制縮小 */
    transition: opacity 0.3s ease-out, transform 0.3s ease-out !important; /* 過渡效果 */
    pointer-events: none; /* 禁用交互 */
}
/* 主要按鈕樣式 (結果頁面用) */
.primary-btn {
    background-color: var(--primary-color); /* 主色背景 */
    color: white; /* 白色文字 */
}
.primary-btn:hover {
    background-color: #e53935; /* Hover 時顏色加深 */
    transform: translateY(-2px); /* 輕微上移 */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* 添加陰影 */
}
/* 次要按鈕樣式 (結果頁面用) */
.secondary-btn {
    background-color: transparent; /* 透明背景 */
    color: white; /* 預設白色文字 (會被 result-container 覆蓋) */
    border: 1px solid white; /* 預設白色邊框 */
}
.secondary-btn:hover {
    background-color: rgba(255, 255, 255, 0.1); /* Hover 時輕微亮色背景 */
}
/* 結果頁面按鈕顏色覆蓋 */
#result-container .primary-btn {
    background-color: var(--primary-color);
    color: white;
}
#result-container .primary-btn:hover {
    background-color: #e53935;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}
#result-container .secondary-btn {
    background-color: transparent;
    color: var(--secondary-color); /* 結果頁用深色文字 */
    border: 1px solid var(--secondary-color); /* 結果頁用深色邊框 */
}
#result-container .secondary-btn:hover {
    background-color: rgba(0, 0, 0, 0.05); /* Hover 時輕微深色背景 */
    transform: translateY(-2px);
}

/* ================= 測驗頁面 ================= */
/* 測驗頁面容器 */
#test-container {
    display: flex; flex-direction: column; /* 垂直 Flexbox 佈局 */
    align-items: center; /* 水平居中 */
    justify-content: center; /* 垂直居中 */
    padding: 80px 20px 40px; /* 上下左右內邊距 */
    perspective: 800px; /* 3D 透視 */
    position: relative; /* 相對定位 */
}
/* 測驗頁面背景圖 */
#test-background {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-size: contain; /* 完整顯示圖片 */
    background-position: center center; /* 居中 */
    background-repeat: no-repeat; /* 不重複 */
    z-index: 5; /* 背景層級 */
    opacity: 1; /* 初始不透明 */
    filter: blur(0px); /* 初始無模糊 */
    transition: opacity 0.8s ease-out, filter 0.8s ease-out; /* 過渡效果 */
    background-color: var(--deep-blue-bg); /* 背景色 */
}
/* 背景圖隱藏時的樣式 */
#test-background.is-hidden {
    opacity: 0; /* 透明 */
    filter: blur(10px); /* 模糊 */
    pointer-events: none; /* 禁用交互 */
}
/* 進度條容器 */
.progress-container {
    position: absolute; /* 絕對定位在頂部 */
    top: 0; left: 0; width: 100%;
    padding: 10px 15px 5px; /* 內邊距 */
    /* 頂部漸變遮罩，使進度條更明顯 */
    background: linear-gradient(to bottom, rgba(18, 24, 36, 0.7), rgba(18, 24, 36, 0));
    z-index: 30; /* 確保在最上層 */
}
/* 進度條背景 */
.progress-bar {
    background-color: rgba(255, 255, 255, 0.2); /* 半透明背景 */
    height: 4px; /* 高度 */
    border-radius: 2px; /* 圓角 */
    overflow: hidden; /* 隱藏溢出的填充部分 */
}
/* 進度條填充部分 */
.progress-fill {
    background-color: var(--primary-color); /* 主色填充 */
    height: 100%; /* 高度佔滿 */
    width: 0%; /* 初始寬度為 0 */
    /* 寬度變化時的過渡效果 */
    transition: width 0.5s cubic-bezier(0.33, 1, 0.68, 1);
}
/* 問題標題 */
#question-title {
    color: rgba(255, 255, 255, 0.9); /* 文字顏色 */
    font-size: 24px; /* 字號 */
    font-weight: 500; /* 字重 */
    line-height: 1.5; /* 行高 */
    text-align: center; /* 居中 */
    margin-bottom: 40px; /* 與選項的間距 */
    position: relative; /* 相對定位 */
    z-index: 20; /* 層級 */
    width: 100%; max-width: 90%; /* 寬度限制 */
    opacity: 1; filter: blur(0px); transform: translateY(0); /* 初始狀態 */
    /* 過渡效果 */
    transition: opacity 0.5s ease-out, filter 0.5s ease-out, transform 0.5s ease-out;
}
/* 問題標題隱藏時的樣式 */
#question-title.is-hidden {
    opacity: 0; /* 透明 */
    filter: blur(5px); /* 模糊 */
    transform: translateY(15px); /* 向下位移 */
    pointer-events: none; /* 禁用交互 */
}
/* 選項容器 */
#options-container {
    display: flex; /* Flexbox 佈局 */
    flex-direction: column; /* 垂直排列 */
    gap: 15px; /* 選項間距 */
    width: 100%; /* 寬度 */
    max-width: 400px; /* 最大寬度 */
    position: relative; /* 相對定位 */
    z-index: 10; /* 層級 */
}
/* 單個選項樣式 */
.option {
    background-color: rgba(255, 255, 255, 0.1); /* 半透明背景 */
    border: 1px solid rgba(255, 255, 255, 0.2); /* 邊框 */
    color: white; /* 文字顏色 */
    padding: 15px 25px; /* 內邊距 */
    border-radius: 10px; /* 圓角 */
    cursor: pointer; /* 鼠標樣式 */
    text-align: center; /* 文字居中 */
    font-size: 16px; /* 字號 */
    /* 過渡效果 */
    transition: background-color 0.3s ease, opacity 0.5s ease-out, filter 0.5s ease-out, transform 0.5s ease-out;
    position: relative; /* 相對定位 */
    overflow: hidden; /* 隱藏溢出 */
    min-height: 50px; /* 最小高度 */
    transform-style: preserve-3d; /* 用於 3D 效果 */
    opacity: 1; filter: blur(0px); transform: translateY(0); /* 初始狀態 */
}
/* 選項隱藏時的樣式 (用於入場動畫) */
.option.is-hidden {
    opacity: 0; /* 透明 */
    filter: blur(5px); /* 模糊 */
    transform: translateY(15px); /* 向下位移 */
    pointer-events: none; /* 禁用交互 */
}
/* 選項淡出時的樣式 */
.option.fade-out {
    opacity: 0 !important; /* 強制透明 */
    filter: blur(8px) !important; /* 強制模糊 */
    transform: translateY(0) !important; /* 保持 Y 軸位置 */
    transition: opacity 0.5s ease-out, filter 0.5s ease-out !important; /* 過渡效果 */
    pointer-events: none; /* 禁用交互 */
}
/* 選項被“爆炸”後的樣式 */
.option.exploded {
    opacity: 0 !important; /* 強制透明 */
    transform: scale(0.9) !important; /* 強制縮小 */
    transition: opacity 0.3s ease-out, transform 0.3s ease-out !important; /* 過渡效果 */
    pointer-events: none; /* 禁用交互 */
}
/* 選項 Hover 效果 */
.option:hover {
    background-color: var(--button-hover-bg); /* 使用統一的 hover 背景色 */
    /* transform: scale(1.02); */ /* 可選：添加輕微放大效果 */
}

/* ================= Explosion Containers ================= */
/* 爆炸效果容器樣式 */
#explosion-container { /* 主爆炸容器，現在也用於開始按鈕 */
    position: absolute; /* 絕對定位 */
    top: 0; left: 0; width: 100%; height: 100%; /* 佔滿父容器 (通常是 test-container 或 body) */
    pointer-events: none; /* 不阻擋滑鼠事件 */
    overflow: hidden; /* 隱藏溢出的粒子 */
    z-index: 1000; /* 最高層級 */
    transform-style: preserve-3d; /* 啟用 3D 效果 */
}
/* 爆炸粒子樣式 */
.char-explode {
    display: inline-block; /* 行內塊 */
    position: absolute; /* 絕對定位 */
    color: white; /* 粒子顏色 */
    font-size: 24px; /* 粒子大小 */
    font-weight: bold; /* 字重 */
    opacity: 1; /* 初始不透明 */
    /* 應用爆炸動畫 */
    animation: explodeForwardBlur var(--explosion-duration) forwards cubic-bezier(0.16, 1, 0.3, 1);
    white-space: pre; /* 保留空白符 */
    will-change: transform, opacity, filter; /* 預告動畫屬性 */
    transform-style: preserve-3d; /* 啟用 3D */
    filter: blur(0px); /* 初始無模糊 */
}


/* ================= 結果頁面樣式 ================= */
/* 結果卡片 */
.result-card {
    background-color: white; /* 背景色 */
    border-radius: var(--border-radius); /* 圓角 */
    box-shadow: 0 5px 15px var(--shadow-color); /* 陰影 */
    padding: var(--card-padding); /* 內邊距 */
    max-width: 800px; /* 最大寬度 */
    margin: 40px auto; /* 上下外邊距，左右自動居中 */
    text-align: center; /* 文字居中 */
    animation: fadeIn 0.8s ease-out; /* 淡入動畫 */
}
/* 結果標題 */
.result-title {
    font-size: 24px; /* 字號 */
    color: var(--primary-color); /* 主色 */
    margin-bottom: 15px; /* 下邊距 */
}
/* 結果副標題 */
.result-subtitle {
    font-style: italic; /* 斜體 */
    color: var(--secondary-color); /* 深色文字 */
    margin-bottom: 20px; /* 下邊距 */
}
/* 結果描述 */
.result-description {
    padding: 20px; /* 內邊距 */
    background-color: rgba(0, 0, 0, 0.03); /* 淺灰色背景 */
    border-radius: 8px; /* 圓角 */
    margin-bottom: 25px; /* 下邊距 */
    text-align: left; /* 左對齊 */
}
/* 書本特質和相關書籍區域 */
.book-traits, .related-books {
    margin: 25px 0; /* 上下外邊距 */
    animation: fadeIn 1s ease-out 0.3s backwards; /* 淡入動畫，延遲 */
}
/* 小標題 (h3) */
h3 {
    color: var(--secondary-color); /* 深色文字 */
    margin-bottom: 15px; /* 下邊距 */
    font-size: 18px; /* 字號 */
}
/* 特質項目 */
.trait-item {
    display: flex; /* Flexbox 佈局 */
    justify-content: space-between; /* 兩端對齊 */
    margin-bottom: 10px; /* 下邊距 */
    padding: 5px 10px; /* 內邊距 */
    border-radius: 6px; /* 圓角 */
    transition: background-color 0.3s ease; /* 背景色過渡 */
}
.trait-item:hover {
    background-color: rgba(0, 0, 0, 0.03); /* Hover 背景色 */
}
/* 特質星級 */
.trait-stars {
    color: var(--primary-color); /* 主色 */
}
/* 分享區域 */
.share-section {
    margin: 25px 0; /* 上下外邊距 */
}
/* 分享文本框 */
.share-text {
    background-color: #f9f9f9; /* 背景色 */
    padding: 15px; /* 內邊距 */
    border-radius: 8px; /* 圓角 */
    border: 1px solid #ddd; /* 邊框 */
    margin: 15px 0; /* 上下外邊距 */
    white-space: pre-wrap; /* 保留空白符並換行 */
    text-align: left; /* 左對齊 */
    animation: fadeIn 1s ease-out 0.6s backwards; /* 淡入動畫，更延遲 */
}
/* 操作按鈕容器 */
.action-buttons {
    display: flex; /* Flexbox 佈局 */
    gap: 15px; /* 按鈕間距 */
    margin-top: 20px; /* 上邊距 */
    justify-content: center; /* 水平居中 */
    animation: fadeIn 1s ease-out 0.9s backwards; /* 淡入動畫，最延遲 */
}
/* 操作按鈕 */
.action-buttons .btn {
    flex: 1; /* 佔據可用空間 */
    max-width: 150px; /* 最大寬度 */
}

/* ================= 響應式設計 ================= */
/* 中等屏幕 (平板) */
@media (max-width: 768px) {
    #test-container { padding: 60px 15px 30px; } /* 調整內邊距 */
    #question-title { font-size: 20px; margin-bottom: 30px; } /* 調整字號和間距 */
    #options-container { gap: 10px; } /* 調整選項間距 */
    .option { padding: 12px 20px; font-size: 14px; min-height: 44px;} /* 調整選項樣式 */
    .intro-content { padding: 40px 20px; } /* 調整 Intro 內邊距 */
    .card-body .description { font-size: 16px; } /* 調整描述字號 */
    .card-footer { margin-bottom: 20px; } /* 調整底部間距 */
    .progress-container { padding: 8px 15px 2px; } /* 調整進度條內邊距 */
    .intro-title-placeholder { width: 70%; top: 3%; } /* 調整 Intro 標題位置 */
}
/* 小屏幕 (手機) */
@media (max-width: 375px) and (max-height: 667px) { /* 針對特定小尺寸優化 */
    #question-title { font-size: 18px; margin-bottom: 25px; }
    .option { padding: 10px 15px; font-size: 13px; min-height: 40px; }
    #options-container { gap: 8px; }
    .intro-title-placeholder { width: 80%; }
}
/* 橫向屏幕 */
@media (max-width: 900px) and (orientation: landscape) {
    .container { max-width: 100vw; max-height: 100vh; } /* 允許容器佔滿橫向屏幕 */
    #test-container { padding: 20px; justify-content: center; } /* 調整內邊距 */
    #question-title { margin-bottom: 20px; font-size: 20px; } /* 調整標題間距 */
    #options-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 90%; } /* 選項變為兩列 */
    .result-card { margin: 20px auto; } /* 調整結果卡片外邊距 */
    .intro-title-placeholder { width: 40%; top: 2%; } /* 調整 Intro 標題大小和位置 */
}
