/* ================= 基本樣式與變數 ================= */
:root {
    --primary-color: #f64740;
    --secondary-color: #333333;
    --background-color: #f5f5f5; /* 結果頁背景 */
    --text-color: #ffffff; /* 主要文字 (白) */
    --text-color-dark: #333333; /* 結果頁文字 */
    --shadow-color: rgba(0, 0, 0, 0.2);
    --card-padding: 24px;
    --border-radius: 12px;
    --transition-duration: 0.6s; /* 基礎屏幕切換時間 */
    --transition-timing: cubic-bezier(0.25, 0.1, 0.25, 1.0);
    --deep-blue-bg: #121824; /* 深藍背景 */
    --preloader-exit-duration: 1.2s; /* Duration for preloader SVG animation */
    --intro-fadein-delay: 0.8s; /* Delay before intro content fades in */
    --intro-fadein-duration: 1s;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Noto Serif TC', serif, 'Times New Roman', Times, serif;
    line-height: 1.6; background-color: var(--deep-blue-bg); color: var(--text-color);
    height: 100vh; width: 100vw; overflow: hidden; margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    perspective: 800px;
}

.container {
    width: 100%; max-width: calc(100vh * 9 / 16); height: 100vh;
    max-height: calc(100vw * 16 / 9); position: relative; overflow: hidden;
    background-color: var(--deep-blue-bg); box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
    margin: auto;
}

/* ================= 動畫關鍵幀 ================= */
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes explodeForwardBlur {
    0% { opacity: 1; filter: blur(0px); transform: translate3d(0, 0, 5px) rotate(0deg) scale(1); }
    60% { opacity: 0.9; filter: blur(1px); }
    90% { opacity: 0.4; filter: blur(4px); }
    100% { opacity: 0; filter: blur(8px); transform: translate3d(var(--tx, 0), var(--ty, 0), var(--tz, 0)) rotate(var(--rz, 0deg)) scale(var(--sc, 1)); }
}
/* --- NEW: Preloader Exit Keyframes --- */
@keyframes preloaderSvgExit {
    from {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    to {
        opacity: 0;
        /* Adjust translateY to move it further up, maybe off-screen */
        transform: translateY(-150%) scale(0.5);
    }
}
@keyframes preloaderBgFadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}
/* --- NEW: Intro Content Fade In --- */
@keyframes introElementFadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}


/* ================= 預加載畫面 ================= */
.preloader {
    z-index: 9999;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: var(--deep-blue-bg);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    transition: visibility 0s linear var(--preloader-exit-duration); /* Hide after animation */
    visibility: hidden;
}
.preloader.active {
    opacity: 1;
    pointer-events: auto;
    visibility: visible;
    transition: none; /* Remove fade-in transition, it's active immediately */
}
/* --- NEW: State for preloader animating out --- */
.preloader.transitioning-out {
    /* Animate background fade out */
    animation: preloaderBgFadeOut var(--preloader-exit-duration) ease-out forwards;
    pointer-events: none; /* Disable interaction during exit */
}
/* Keep content centered while background fades */
.preloader.transitioning-out .preloader-content {
     background-color: transparent; /* Ensure content bg doesn't linger */
}
/* Animate SVG specifically */
.preloader.transitioning-out #text {
    animation: preloaderSvgExit var(--preloader-exit-duration) cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards; /* Ease-in-back like effect */
}
/* Hide text elements faster during exit */
.preloader.transitioning-out .preloader-text,
.preloader.transitioning-out #preloader-progress {
    transition: opacity 0.3s ease-out;
    opacity: 0;
}

.preloader-content {
    text-align: center;
    color: var(--text-color);
    width: 90%;
    max-width: 400px;
    position: relative; /* Needed for SVG positioning if adjusted */
}

/* SVG Container Styles */
#preloader #text {
    width: 100%;
    height: auto;
    display: block;
    margin: 0 auto 20px;
    overflow: visible;
    animation: glow 2.5s ease-in-out infinite alternate;
    will-change: filter, transform, opacity; /* Add transform/opacity for exit */
    /* Make sure no transform is applied initially */
    transform: translateY(0) scale(1);
    opacity: 1;
}

/* Stroke Animation Setup */
#preloader #text path {
    stroke-width: 0.5px;
    stroke-dasharray: 1500;
    stroke-dashoffset: 1500;
    fill: none;
    will-change: stroke-dashoffset, fill;
}
#preloader #text .st1 { stroke: #ffffff; animation: drawStrokeAndFillWhite 4s ease-out forwards; }
#preloader #text .st3 { stroke: #f2f2f2; animation: drawStrokeAndFillGrey 4s ease-out forwards 0.5s; }
#preloader #text .st0,
#preloader #text .st2,
#preloader #text .st4,
#preloader #text .st5 { opacity: 0; animation: fadeInPath 2s ease-in forwards 2s; }

/* Keyframes for Stroke Drawing and Filling */
@keyframes drawStrokeAndFillWhite { /* Unchanged */
    0% { stroke-dashoffset: 1500; fill: none; opacity: 1; } 75% { stroke-dashoffset: 0; fill: none; opacity: 1; } 100% { stroke-dashoffset: 0; fill: #ffffff; opacity: 1; }
}
@keyframes drawStrokeAndFillGrey { /* Unchanged */
     0% { stroke-dashoffset: 1500; fill: none; opacity: 1; } 75% { stroke-dashoffset: 0; fill: none; opacity: 1; } 100% { stroke-dashoffset: 0; fill: #f2f2f2; opacity: 1; }
}
@keyframes fadeInPath { from { opacity: 0; } to { opacity: 1; } }
@keyframes glow { /* Unchanged */
    from { filter: drop-shadow(0 0 4px rgba(246, 71, 64, 0.7)) drop-shadow(0 0 8px rgba(255, 255, 255, 0.3)); }
    to { filter: drop-shadow(0 0 10px rgba(246, 71, 64, 1)) drop-shadow(0 0 15px rgba(255, 255, 255, 0.5)); }
}

.preloader-text { font-size: 18px; margin-bottom: 10px; }
#preloader-progress { font-size: 24px; font-weight: bold; color: var(--primary-color); }

/* ================= 通用屏幕容器 ================= */
.screen-container { /* Unchanged */ display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity var(--transition-duration) var(--transition-timing); overflow: hidden; background-color: var(--deep-blue-bg); }
.screen-container.active { display: block; opacity: 1; }
.screen-container.fade-out { animation: fadeOut var(--transition-duration) var(--transition-timing) forwards; }
.screen-container.fade-in { animation: fadeIn var(--transition-duration) var(--transition-timing) forwards; }

/* ================= 首頁卡片式設計 ================= */
/* --- NEW: Separate background and content for intro --- */
#intro-container {
    display: block; /* Keep it block, manage visibility with opacity */
    opacity: 0; /* Start hidden */
    transition: opacity var(--intro-fadein-duration) ease-out; /* Fade in */
}
#intro-container.visible {
    opacity: 1;
}

.intro-background {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-size: cover; background-position: center; z-index: 1;
    opacity: 0; /* Start hidden */
    transition: opacity var(--intro-fadein-duration) ease-out var(--intro-fadein-delay); /* Fade in after delay */
}
.intro-overlay { /* Gradient overlay */
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 30%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0.7) 100%);
    z-index: 2;
    opacity: 0; /* Start hidden */
    transition: opacity var(--intro-fadein-duration) ease-out var(--intro-fadein-delay); /* Fade in after delay */
}

.intro-content {
    position: relative; z-index: 3; /* Above background and overlay */
    height: 100%; display: flex; flex-direction: column; justify-content: space-between;
    padding: 40px 30px;
}

/* --- NEW: Intro Title Placeholder --- */
.intro-title-placeholder {
    position: absolute;
    top: 5%; /* Adjust as needed */
    left: 50%;
    transform: translateX(-50%);
    width: 60%; /* Adjust width */
    max-width: 300px; /* Max width */
    z-index: 4;
    opacity: 0; /* Start hidden */
    /* Animation applied via JS */
    animation: introElementFadeIn var(--intro-fadein-duration) ease-out calc(var(--intro-fadein-delay) + 0.2s) forwards; /* Staggered fade-in */
}
#intro-title-svg {
    width: 100%;
    height: auto;
    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); /* Optional glow */
}
#intro-title-svg path { /* Style paths if needed */
    fill: #fff; /* Example fill */
}


/* Apply fade-in to body and footer as well */
.card-body, .card-footer {
    opacity: 0;
    animation: introElementFadeIn var(--intro-fadein-duration) ease-out calc(var(--intro-fadein-delay) + 0.4s) forwards; /* Staggered fade-in */
}

.card-body { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.card-body .description { font-size: 18px; line-height: 1.6; margin-bottom: 20px; max-width: 90%; text-align: center; margin-left: auto; margin-right: auto; }
.card-footer { margin-bottom: 40px; text-align: center; position: relative; /* For explosion container */ }
.card-meta { margin-top: 20px; font-size: 12px; opacity: 0.7; text-align: center; }

/* ================= 按鈕樣式 ================= */
.btn { display: inline-block; padding: 14px 28px; border-radius: 50px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-family: 'Noto Serif TC', serif; text-align: center; margin: 0 auto; position: relative; /* For text span */ }

/* --- NEW: SVG Style Button --- */
.btn-svg-style {
    background-color: transparent;
    border: 1px solid rgba(255, 255, 255, 0.7); /* Stroke */
    color: rgba(255, 255, 255, 0.9); /* Text fill */
    padding: 12px 30px; /* Adjust padding */
    border-radius: 8px; /* Less rounded? */
    transition: background-color 0.4s ease, color 0.4s ease, box-shadow 0.4s ease, transform 0.3s ease;
    box-shadow: 0 0 8px rgba(246, 71, 64, 0); /* Initial transparent glow */
}
.btn-svg-style:hover {
    background-color: rgba(246, 71, 64, 0.15); /* Subtle fill on hover */
    color: #ffffff;
    border-color: rgba(255, 255, 255, 0.9);
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 0 15px rgba(246, 71, 64, 0.6); /* Glow effect */
}
.btn-svg-style .btn-text {
    display: inline-block; /* Needed for potential transform/opacity */
    transition: opacity 0.3s ease;
    opacity: 1; /* Make sure it's visible initially */
}
.btn-svg-style .btn-text.hidden {
    opacity: 0; /* Hide text during explosion */
}


/* Keep original primary/secondary styles for results page */
.primary-btn { background-color: var(--primary-color); color: white; }
.primary-btn:hover { background-color: #e53935; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
.secondary-btn { background-color: transparent; color: white; border: 1px solid white; }
.secondary-btn:hover { background-color: rgba(255, 255, 255, 0.1); }
#result-container .primary-btn { background-color: var(--primary-color); color: white; }
#result-container .primary-btn:hover { background-color: #e53935; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
#result-container .secondary-btn { background-color: transparent; color: var(--secondary-color); border: 1px solid var(--secondary-color); }
#result-container .secondary-btn:hover { background-color: rgba(0, 0, 0, 0.05); transform: translateY(-2px); }

/* ================= 測驗頁面 ================= */
#test-container { /* Unchanged */ display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 80px 20px 40px; background-color: transparent; perspective: 800px; position: relative; }
#test-background { /* Unchanged */ position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; z-index: 5; opacity: 1; filter: blur(0px); transition: opacity 0.8s ease-out, filter 0.8s ease-out; }
#test-background.is-hidden { opacity: 0; filter: blur(10px); pointer-events: none; }
.progress-container { /* Unchanged */ position: absolute; top: 0; left: 0; width: 100%; padding: 10px 15px 5px; background: linear-gradient(to bottom, rgba(18, 24, 36, 0.7), rgba(18, 24, 36, 0)); z-index: 30; }
.progress-bar { /* Unchanged */ background-color: rgba(255, 255, 255, 0.2); height: 4px; border-radius: 2px; overflow: hidden; }
.progress-fill { /* Unchanged */ background-color: var(--primary-color); height: 100%; width: 0%; transition: width 0.5s cubic-bezier(0.33, 1, 0.68, 1); }
#question-title { /* Unchanged */ color: rgba(255, 255, 255, 0.9); font-size: 24px; font-weight: 500; line-height: 1.5; text-align: center; margin-bottom: 40px; position: relative; z-index: 20; width: 100%; max-width: 90%; opacity: 1; filter: blur(0px); transform: translateY(0); transition: opacity 0.5s ease-out, filter 0.5s ease-out; }
#question-title.is-hidden { opacity: 0; filter: blur(5px); pointer-events: none; }
#options-container { /* Unchanged */ display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 400px; position: relative; z-index: 10; }
.option { /* Unchanged */ background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 15px 25px; border-radius: 10px; cursor: pointer; text-align: center; font-size: 16px; transition: background-color 0.3s ease, opacity 0.5s ease-out, filter 0.5s ease-out, transform 0.5s ease-out; position: relative; overflow: hidden; min-height: 50px; transform-style: preserve-3d; opacity: 1; filter: blur(0px); transform: translateY(0); }
.option.is-hidden { opacity: 0; filter: blur(5px); transform: translateY(15px); pointer-events: none; }
.option.fade-out { opacity: 0 !important; filter: blur(8px) !important; transform: translateY(0) !important; transition: opacity 0.5s ease-out, filter 0.5s ease-out !important; pointer-events: none; }
.option.exploded { opacity: 0 !important; transform: scale(0.9) !important; transition: opacity 0.3s ease-out, transform 0.3s ease-out !important; pointer-events: none; }
.option:hover { background-color: rgba(255, 255, 255, 0.2); }

/* ================= Explosion Containers ================= */
#explosion-container, /* Container for options */
#start-btn-explosion-container /* Container for start button */ {
    position: absolute; /* Position relative to parent (.card-footer or #test-container) */
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; overflow: hidden; z-index: 1000;
    transform-style: preserve-3d;
}
/* Adjust position for start button container if needed */
#start-btn-explosion-container {
    position: absolute; /* Absolute relative to card-footer */
    top: 0; /* Position it relative to the button's location via JS */
    left: 0;
    width: 100%;
    height: 100%;
    /* background: rgba(255, 0, 0, 0.1); */ /* Uncomment to visualize */
}


.char-explode { /* Unchanged */ display: inline-block; position: absolute; color: white; font-size: 24px; font-weight: bold; opacity: 1; animation: explodeForwardBlur 1.0s forwards cubic-bezier(0.16, 1, 0.3, 1); white-space: pre; will-change: transform, opacity, filter; transform-style: preserve-3d; filter: blur(0px); }

/* ================= 結果頁面樣式 ================= */
#result-container { /* Unchanged */ background-color: var(--background-color); padding: 20px; overflow-y: auto; color: var(--text-color-dark); &::-webkit-scrollbar { width: 0; display: none; background: transparent; } scrollbar-width: none; -ms-overflow-style: none; }
.result-card { /* Unchanged */ background-color: white; border-radius: var(--border-radius); box-shadow: 0 5px 15px var(--shadow-color); padding: var(--card-padding); max-width: 800px; margin: 40px auto; text-align: center; animation: fadeIn 0.8s ease-out; }
.result-title { /* Unchanged */ font-size: 24px; color: var(--primary-color); margin-bottom: 15px; }
.result-subtitle { /* Unchanged */ font-style: italic; color: var(--secondary-color); margin-bottom: 20px; }
.result-description { /* Unchanged */ padding: 20px; background-color: rgba(0, 0, 0, 0.03); border-radius: 8px; margin-bottom: 25px; text-align: left; }
.book-traits, .related-books { /* Unchanged */ margin: 25px 0; animation: fadeIn 1s ease-out 0.3s backwards; }
h3 { /* Unchanged */ color: var(--secondary-color); margin-bottom: 15px; font-size: 18px; }
.trait-item { /* Unchanged */ display: flex; justify-content: space-between; margin-bottom: 10px; padding: 5px 10px; border-radius: 6px; transition: background-color 0.3s ease; }
.trait-item:hover { background-color: rgba(0, 0, 0, 0.03); }
.trait-stars { /* Unchanged */ color: var(--primary-color); }
.share-text { /* Unchanged */ background-color: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin: 15px 0; white-space: pre-wrap; text-align: left; animation: fadeIn 1s ease-out 0.6s backwards; }
.action-buttons { /* Unchanged */ display: flex; gap: 15px; margin-top: 20px; justify-content: center; animation: fadeIn 1s ease-out 0.9s backwards; }
.action-buttons .btn { flex: 1; max-width: 150px; }

/* ================= 響應式設計 ================= */
@media (max-width: 768px) { /* Unchanged */ #test-container { padding: 60px 15px 30px; } #question-title { font-size: 20px; margin-bottom: 30px; } #options-container { gap: 10px; } .option { padding: 12px 20px; font-size: 14px; min-height: 44px;} .intro-content { padding: 40px 20px; } .card-body .description { font-size: 16px; } .card-footer { margin-bottom: 20px; } .progress-container { padding: 8px 15px 2px; } .intro-title-placeholder { width: 70%; top: 3%; } }
@media (max-width: 375px) and (max-height: 667px) { /* Unchanged */ #question-title { font-size: 18px; margin-bottom: 25px; } .option { padding: 10px 15px; font-size: 13px; min-height: 40px; } #options-container { gap: 8px; } .intro-title-placeholder { width: 80%; } }
@media (max-width: 900px) and (orientation: landscape) { /* Unchanged */ .container { max-width: 100vw; max-height: 100vh; } #test-container { padding: 20px; justify-content: center; } #question-title { margin-bottom: 20px; font-size: 20px; } #options-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 90%; } .result-card { margin: 20px auto; } .intro-title-placeholder { width: 40%; top: 2%; } }